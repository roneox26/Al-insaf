<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>এক নজরে মাসিক শীট</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: white; font-size: 10px; margin: 0; padding: 5px; }
    .sheet-table { width: 100%; border-collapse: collapse; font-size: 7px; }
    .sheet-table th, .sheet-table td { border: 1px solid #000; padding: 1px 2px; text-align: center; }
    .sheet-table th { background: #f0f0f0; font-weight: bold; }
    .member-col { text-align: left; min-width: 50px; max-width: 80px; font-size: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .date-header { font-weight: bold; font-size: 7px; }
    .sub-header { font-size: 6px; }
    .total-col { background: #ffffcc; font-weight: bold; }
    @media print {
      .no-print { display: none !important; }
      @page { size: landscape; margin: 3mm; }
      body { font-size: 5px; margin: 0; padding: 0; }
      .sheet-table { font-size: 4px; page-break-inside: auto; width: 100%; }
      .sheet-table th, .sheet-table td { padding: 0.5px 1px; border: 0.5px solid #000; }
      .member-col { font-size: 4px; max-width: 50px; }
      .date-header { font-size: 5px; }
      .sub-header { font-size: 4px; }
      h6 { font-size: 9px; margin: 2px 0; }
      .print-header { font-size: 7px; margin-bottom: 2px; }
    }
  </style>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
</head>
<body>
  <div class="container-fluid">
    <div class="no-print mb-2">
      <a href="{{ url_for('dashboard') }}" class="btn btn-secondary btn-sm">← Back</a>
      <button onclick="window.print()" class="btn btn-primary btn-sm">🖨️ Print</button>
      
      <form method="GET" class="d-inline-block ms-2">
        <select name="month" class="form-select form-select-sm d-inline-block" style="width: auto;">
          {% for m in range(1, 13) %}
          <option value="{{ m }}" {% if m == month %}selected{% endif %}>{{ ['', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'][m] }}</option>
          {% endfor %}
        </select>
        <input type="number" name="year" value="{{ year }}" class="form-control form-control-sm d-inline-block" style="width: 80px;">
        <button type="submit" class="btn btn-success btn-sm">দেখুন</button>
      </form>
    </div>

    <h6 class="text-center mb-1">এক নজরে মাসিক শীট - {{ month_name }} {{ year }}</h6>

    <div style="overflow-x: auto;">
      <table class="sheet-table">
        <thead>
          <tr>
            <th rowspan="2" class="member-col-header">সদস্য নং</th>
            <th rowspan="2" class="member-col-header">সদস্যের নাম</th>
            {% for day in range(1, last_day + 1) %}
            <th colspan="2" class="date-header">{{ '%02d-%02d-%d' % (day, month, year) }}</th>
            {% endfor %}
            <th colspan="2" class="total-col">মোট</th>
          </tr>
          <tr>
            {% for day in range(1, last_day + 1) %}
            <th class="sub-header">কিস্তি</th>
            <th class="sub-header">সঞ্চয়</th>
            {% endfor %}
            <th class="sub-header total-col">কিস্তি</th>
            <th class="sub-header total-col">সঞ্চয়</th>
          </tr>
        </thead>
        <tbody>
          {% for customer in customers %}
          <tr>
            <td class="member-col">{{ customer.member_no }}</td>
            <td class="member-col">{{ customer.name }}</td>
            {% set total_loan = 0 %}
            {% set total_saving = 0 %}
            {% for day in range(1, last_day + 1) %}
            <td>
              {% if customer_data[customer.id][day]['loan'] > 0 %}
              {{ "{:,.0f}".format(customer_data[customer.id][day]['loan']) }}
              {% set total_loan = total_loan + customer_data[customer.id][day]['loan'] %}
              {% else %}
              -
              {% endif %}
            </td>
            <td>
              {% if customer_data[customer.id][day]['saving'] > 0 %}
              {{ "{:,.0f}".format(customer_data[customer.id][day]['saving']) }}
              {% set total_saving = total_saving + customer_data[customer.id][day]['saving'] %}
              {% else %}
              -
              {% endif %}
            </td>
            {% endfor %}
            <td class="total-col">{{ "{:,.0f}".format(total_loan) if total_loan > 0 else '-' }}</td>
            <td class="total-col">{{ "{:,.0f}".format(total_saving) if total_saving > 0 else '-' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
