<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Customer Search - Al-Insaf NGO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-responsive.css') }}">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .search-container { max-width: 1600px; margin: 0 auto; padding: 20px 15px; }
        .search-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .search-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 20px 20px 0 0; }
        .search-input { font-size: 1.1rem; padding: 12px 20px; border-radius: 50px; border: 3px solid #667eea; }
        .search-input:focus { border-color: #764ba2; box-shadow: 0 0 0 0.25rem rgba(118, 75, 162, 0.25); }
        .customer-card { transition: all 0.3s; border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .customer-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .card-header-custom { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-bottom: 3px solid #dee2e6; padding: 15px; }
        .info-section { background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .info-section h6 { color: #495057; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; border-bottom: 2px solid #dee2e6; padding-bottom: 5px; }
        .info-item { padding: 4px 0; font-size: 0.85rem; display: flex; align-items: center; }
        .info-item i { width: 20px; margin-right: 8px; }
        .info-label { font-weight: 600; color: #6c757d; min-width: 90px; }
        .info-value { color: #212529; flex: 1; }
        .stat-box { text-align: center; padding: 10px; border-radius: 8px; }
        .action-buttons { display: flex; gap: 5px; }
    </style>
</head>
<body>
    <div class="search-container">
        <div class="search-card">
            <div class="search-header text-center">
                <h1 class="mb-3"><i class="fas fa-search-plus"></i> Advanced Customer Search</h1>
                <p class="mb-0">‡¶®‡¶æ‡¶Æ, ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶Ç, ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</p>
            </div>
            
            <div class="p-4">
                <div class="mb-4">
                    <input type="text" id="customerSearch" class="form-control search-input" placeholder="üîç ‡¶®‡¶æ‡¶Æ, ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶Ç, ‡¶´‡ßã‡¶®..." autocomplete="off" autofocus>
                </div>
                
                <div id="searchResults" class="row g-3"></div>
                
                <div id="emptyState" class="text-center py-5 text-muted">
                    <i class="fas fa-search fa-4x mb-3"></i>
                    <h4>Customer ‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶§‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                    <p>‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá 2 ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</p>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="{{ url_for('dashboard') }}" class="btn btn-light btn-lg">
                <i class="fas fa-arrow-left"></i> Dashboard ‡¶è ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const searchInput = document.getElementById('customerSearch');
        const searchResults = document.getElementById('searchResults');
        const emptyState = document.getElementById('emptyState');
        let searchTimeout;

        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            if (query.length < 2) {
                searchResults.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            searchResults.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary" role="status"></div></div>';

            searchTimeout = setTimeout(() => {
                fetch(`/api/search_customers?q=${encodeURIComponent(query)}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.customers.length === 0) {
                            searchResults.innerHTML = `
                                <div class="col-12 text-center py-5 text-muted">
                                    <i class="fas fa-inbox fa-3x mb-3"></i>
                                    <h4>‡¶ï‡ßã‡¶®‡ßã ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h4>
                                    <p>"${query}" ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶®‡ßá‡¶á</p>
                                </div>
                            `;
                            return;
                        }

                        let html = '';
                        data.customers.forEach(c => {
                            let statusBadge = '';
                            if (c.loan_status === '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§') {
                                statusBadge = '<span class="badge bg-success"><i class="fas fa-check-circle"></i> ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</span>';
                            } else if (c.loan_status === '‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®') {
                                statusBadge = '<span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®</span>';
                            } else {
                                statusBadge = '<span class="badge bg-info"><i class="fas fa-user-plus"></i> ‡¶®‡¶§‡ßÅ‡¶®</span>';
                            }
                            
                            html += `
                                <div class="col-lg-6 col-xl-4">
                                    <div class="card customer-card h-100">
                                        <div class="card-header-custom">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div class="flex-grow-1">
                                                    <h5 class="mb-1"><i class="fas fa-user-circle text-primary"></i> ${c.name}</h5>
                                                    <div class="mb-2">
                                                        <span class="badge bg-dark me-1"><i class="fas fa-id-badge"></i> ${c.member_no}</span>
                                                        ${statusBadge}
                                                    </div>
                                                </div>
                                                <div class="action-buttons">
                                                    <a href="/customer_details/${c.id}" class="btn btn-sm btn-primary" title="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="/customer_loan_sheet/${c.id}" class="btn btn-sm btn-success" title="‡¶≤‡ßã‡¶® ‡¶∂‡ßÄ‡¶ü" target="_blank">
                                                        <i class="fas fa-file-invoice"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body p-3">
                                            <!-- Financial Stats -->
                                            <div class="row g-2 mb-3">
                                                <div class="col-4">
                                                    <div class="stat-box bg-primary bg-opacity-10">
                                                        <small class="d-block text-muted" style="font-size: 0.7rem;"><i class="fas fa-coins"></i> ‡¶Æ‡ßã‡¶ü ‡¶≤‡ßã‡¶®</small>
                                                        <strong class="text-primary d-block">‡ß≥${c.total_loan.toLocaleString()}</strong>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="stat-box bg-danger bg-opacity-10">
                                                        <small class="d-block text-muted" style="font-size: 0.7rem;"><i class="fas fa-exclamation-circle"></i> ‡¶¨‡¶æ‡¶ï‡¶ø</small>
                                                        <strong class="text-danger d-block">‡ß≥${c.remaining_loan.toLocaleString()}</strong>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="stat-box bg-success bg-opacity-10">
                                                        <small class="d-block text-muted" style="font-size: 0.7rem;"><i class="fas fa-piggy-bank"></i> ‡¶∏‡ßá‡¶≠‡¶ø‡¶Ç‡¶∏</small>
                                                        <strong class="text-success d-block">‡ß≥${c.savings_balance.toLocaleString()}</strong>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            ${c.total_loan > 0 ? `
                                            <div class="mb-3">
                                                <div class="d-flex justify-content-between align-items-center mb-1">
                                                    <small class="text-muted"><i class="fas fa-chart-line"></i> ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</small>
                                                    <span class="badge ${c.payment_percentage >= 75 ? 'bg-success' : c.payment_percentage >= 50 ? 'bg-info' : c.payment_percentage >= 25 ? 'bg-warning' : 'bg-danger'}">${c.payment_percentage}%</span>
                                                </div>
                                                <div class="progress" style="height: 8px;">
                                                    <div class="progress-bar ${c.payment_percentage >= 75 ? 'bg-success' : c.payment_percentage >= 50 ? 'bg-info' : c.payment_percentage >= 25 ? 'bg-warning' : 'bg-danger'}" 
                                                         style="width: ${c.payment_percentage}%"></div>
                                                </div>
                                            </div>
                                            ` : ''}
                                            
                                            <!-- Contact Info -->
                                            <div class="info-section">
                                                <h6><i class="fas fa-address-card"></i> ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ì ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</h6>
                                                <div class="info-item">
                                                    <i class="fas fa-phone text-success"></i>
                                                    <span class="info-label">‡¶´‡ßã‡¶®:</span>
                                                    <span class="info-value">${c.phone}</span>
                                                </div>
                                                <div class="info-item">
                                                    <i class="fas fa-map-marker-alt text-danger"></i>
                                                    <span class="info-label">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ:</span>
                                                    <span class="info-value">${c.village}</span>
                                                </div>
                                                ${c.post !== 'N/A' ? `<div class="info-item">
                                                    <i class="fas fa-envelope text-info"></i>
                                                    <span class="info-label">‡¶™‡ßã‡¶∏‡ßç‡¶ü:</span>
                                                    <span class="info-value">${c.post}</span>
                                                </div>` : ''}
                                                ${c.thana !== 'N/A' ? `<div class="info-item">
                                                    <i class="fas fa-building text-primary"></i>
                                                    <span class="info-label">‡¶•‡¶æ‡¶®‡¶æ:</span>
                                                    <span class="info-value">${c.thana}</span>
                                                </div>` : ''}
                                                ${c.district !== 'N/A' ? `<div class="info-item">
                                                    <i class="fas fa-city text-success"></i>
                                                    <span class="info-label">‡¶ú‡ßá‡¶≤‡¶æ:</span>
                                                    <span class="info-value">${c.district}</span>
                                                </div>` : ''}
                                                ${c.address !== 'N/A' ? `<div class="info-item">
                                                    <i class="fas fa-home text-secondary"></i>
                                                    <span class="info-label">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</span>
                                                    <span class="info-value">${c.address}</span>
                                                </div>` : ''}
                                            </div>
                                            
                                            <!-- Personal Info -->
                                            <div class="info-section">
                                                <h6><i class="fas fa-user"></i> ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø</h6>
                                                <div class="info-item">
                                                    <i class="fas fa-male text-primary"></i>
                                                    <span class="info-label">‡¶™‡¶ø‡¶§‡¶æ/‡¶∏‡ßç‡¶¨‡¶æ‡¶Æ‡ßÄ:</span>
                                                    <span class="info-value">${c.father_husband}</span>
                                                </div>
                                                ${c.granter !== 'N/A' ? `<div class="info-item">
                                                    <i class="fas fa-user-shield text-warning"></i>
                                                    <span class="info-label">‡¶ú‡¶æ‡¶Æ‡¶ø‡¶®‡¶¶‡¶æ‡¶∞:</span>
                                                    <span class="info-value">${c.granter}</span>
                                                </div>` : ''}
                                                <div class="info-item">
                                                    <i class="fas fa-briefcase text-info"></i>
                                                    <span class="info-label">‡¶™‡ßá‡¶∂‡¶æ:</span>
                                                    <span class="info-value">${c.profession}</span>
                                                </div>
                                                <div class="info-item">
                                                    <i class="fas fa-id-card text-secondary"></i>
                                                    <span class="info-label">NID:</span>
                                                    <span class="info-value">${c.nid_no}</span>
                                                </div>
                                            </div>
                                            
                                            <!-- Fees -->
                                            ${(c.admission_fee > 0 || c.welfare_fee > 0 || c.application_fee > 0) ? `
                                            <div class="info-section">
                                                <h6><i class="fas fa-money-bill-wave"></i> ‡¶´‡¶ø ‡¶∏‡¶Æ‡ßÇ‡¶π</h6>
                                                ${c.admission_fee > 0 ? `<div class="info-item">
                                                    <i class="fas fa-money-bill text-success"></i>
                                                    <span class="info-label">‡¶≠‡¶∞‡ßç‡¶§‡¶ø ‡¶´‡¶ø:</span>
                                                    <span class="info-value text-success fw-bold">‡ß≥${c.admission_fee.toLocaleString()}</span>
                                                </div>` : ''}
                                                ${c.welfare_fee > 0 ? `<div class="info-item">
                                                    <i class="fas fa-hand-holding-usd text-info"></i>
                                                    <span class="info-label">‡¶ï‡¶≤‡ßç‡¶Ø‡¶æ‡¶£ ‡¶´‡¶ø:</span>
                                                    <span class="info-value text-info fw-bold">‡ß≥${c.welfare_fee.toLocaleString()}</span>
                                                </div>` : ''}
                                                ${c.application_fee > 0 ? `<div class="info-item">
                                                    <i class="fas fa-file-invoice-dollar text-primary"></i>
                                                    <span class="info-label">‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶´‡¶ø:</span>
                                                    <span class="info-value text-primary fw-bold">‡ß≥${c.application_fee.toLocaleString()}</span>
                                                </div>` : ''}
                                            </div>
                                            ` : ''}
                                            
                                            <!-- Collection History -->
                                            <div class="info-section">
                                                <h6><i class="fas fa-history"></i> ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º ‡¶§‡¶•‡ßç‡¶Ø</h6>
                                                ${c.total_collected > 0 ? `<div class="info-item">
                                                    <i class="fas fa-coins text-success"></i>
                                                    <span class="info-label">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º:</span>
                                                    <span class="info-value text-success fw-bold">‡ß≥${c.total_collected.toLocaleString()}</span>
                                                </div>` : ''}
                                                ${c.last_collection_date !== '‡¶ï‡¶ñ‡¶®‡ßã ‡¶®‡¶Ø‡¶º' ? `<div class="info-item">
                                                    <i class="fas fa-calendar-check text-primary"></i>
                                                    <span class="info-label">‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º:</span>
                                                    <span class="info-value">${c.last_collection_date}</span>
                                                </div>` : '<div class="alert alert-warning py-1 px-2 mb-0"><small><i class="fas fa-exclamation-triangle"></i> ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</small></div>'}
                                                <div class="info-item">
                                                    <i class="fas fa-calendar-plus text-info"></i>
                                                    <span class="info-label">‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®:</span>
                                                    <span class="info-value">${c.created_date}</span>
                                                </div>
                                                <div class="info-item">
                                                    <i class="fas fa-user-tie text-secondary"></i>
                                                    <span class="info-label">‡¶∏‡ßç‡¶ü‡¶æ‡¶´:</span>
                                                    <span class="info-value">${c.staff_name}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        searchResults.innerHTML = html;
                    })
                    .catch(err => {
                        searchResults.innerHTML = `
                            <div class="col-12 text-center py-5 text-danger">
                                <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                                <h4>Error loading results</h4>
                            </div>
                        `;
                    });
            }, 300);
        });
    </script>
</body>
</html>
