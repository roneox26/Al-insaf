<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <title>শিডিউল ব্যয়</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h2 class="mb-4">📅 শিডিউল ব্যয় ম্যানেজমেন্ট</h2>

  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">নতুন শিডিউল ব্যয় যোগ করুন</h5>
    </div>
    <div class="card-body">
      <form method="POST">
        <div class="row">
          <div class="col-md-3 mb-3">
            <label class="form-label">ক্যাটাগরি *</label>
            <select name="category" class="form-control" required>
              <option value="">নির্বাচন করুন</option>
              <option value="Salary">Salary (বেতন)</option>
              <option value="Office">Office (অফিস)</option>
              <option value="Transport">Transport (যাতায়াত)</option>
              <option value="Other">Other (অন্যান্য)</option>
            </select>
          </div>
          <div class="col-md-2 mb-3">
            <label class="form-label">পরিমাণ (৳) *</label>
            <input type="number" name="amount" class="form-control" step="0.01" required>
          </div>
          <div class="col-md-2 mb-3">
            <label class="form-label">ফ্রিকোয়েন্সি *</label>
            <select name="frequency" class="form-control" required>
              <option value="">নির্বাচন করুন</option>
              <option value="daily">প্রতিদিন</option>
              <option value="weekly">সাপ্তাহিক</option>
              <option value="monthly">মাসিক</option>
              <option value="yearly">বার্ষিক</option>
            </select>
          </div>
          <div class="col-md-2 mb-3">
            <label class="form-label">শুরুর তারিখ *</label>
            <input type="date" name="start_date" class="form-control" value="{{ now.strftime('%Y-%m-%d') }}" required>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label">বিবরণ</label>
            <input type="text" name="description" class="form-control" placeholder="বিবরণ লিখুন">
          </div>
        </div>
        <button type="submit" class="btn btn-success">✅ যোগ করুন</button>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">শিডিউল ব্যয় তালিকা</h5>
    </div>
    <div class="card-body">
      {% if scheduled_expenses %}
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead class="table-dark">
            <tr>
              <th>ক্যাটাগরি</th>
              <th>পরিমাণ</th>
              <th>ফ্রিকোয়েন্সি</th>
              <th>শুরুর তারিখ</th>
              <th>পরবর্তী তারিখ</th>
              <th>বিবরণ</th>
              <th>স্ট্যাটাস</th>
              <th>অ্যাকশন</th>
            </tr>
          </thead>
          <tbody>
            {% for se in scheduled_expenses %}
            <tr>
              <td><span class="badge bg-secondary">{{ se.category }}</span></td>
              <td><strong>৳{{ "{:,.2f}".format(se.amount) }}</strong></td>
              <td>
                {% if se.frequency == 'daily' %}প্রতিদিন
                {% elif se.frequency == 'weekly' %}সাপ্তাহিক
                {% elif se.frequency == 'monthly' %}মাসিক
                {% else %}বার্ষিক{% endif %}
              </td>
              <td>{{ se.start_date.strftime('%d-%m-%Y') }}</td>
              <td>{{ se.next_date.strftime('%d-%m-%Y') }}</td>
              <td>{{ se.description or '-' }}</td>
              <td>
                {% if se.is_active %}
                <span class="badge bg-success">সক্রিয়</span>
                {% else %}
                <span class="badge bg-danger">নিষ্ক্রিয়</span>
                {% endif %}
              </td>
              <td>
                <a href="{{ url_for('toggle_scheduled_expense', id=se.id) }}" class="btn btn-sm btn-warning">
                  {% if se.is_active %}⏸️ বন্ধ{% else %}▶️ চালু{% endif %}
                </a>
                <form method="POST" action="{{ url_for('delete_scheduled_expense', id=se.id) }}" style="display:inline;">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('নিশ্চিত?')">🗑️ ডিলিট</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-center text-muted">কোন শিডিউল ব্যয় নেই</p>
      {% endif %}
    </div>
  </div>

  <div class="mt-3">
    <a href="{{ url_for('manage_expenses') }}" class="btn btn-secondary">⬅️ ব্যয় পেজে ফিরে যান</a>
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">🏠 ড্যাশবোর্ড</a>
  </div>
</body>
</html>
