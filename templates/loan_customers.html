<!doctype html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta charset="utf-8">
  <title>Loan Customers - Al-Insaf NGO</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .page-title { color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
    .table-container { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    .stat-card { border-radius: 12px; transition: all 0.3s; }
    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
  </style>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
</head>

<body>
  <div class="container mt-4 pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4 no-print">
      <h2 class="page-title"><i class="fas fa-hand-holding-usd"></i> Loan Customers</h2>
      <div>
        <button onclick="window.print()" class="btn btn-light me-2"><i class="fas fa-print"></i> Print</button>
        <a href="{{ url_for('manage_customers') }}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back</a>
      </div>
    </div>
    <h2 class="d-none print-only" style="text-align: center; margin-bottom: 5px;">আল-ইনসাফ ক্ষুদ্র ব্যবসায়ী সমবায় সমিতি লিঃ</h2>
    <h3 class="d-none print-only" style="text-align: center; margin: 0;">লোন গ্রাহক তালিকা</h3>
    <p class="d-none print-only" style="text-align: center; margin: 5px 0 15px 0;">
      {% if from_date and to_date %}
        Period: {{ from_date_display }} to {{ to_date_display }}
      {% else %}
        Period: Today ({{ now.strftime('%d %B %Y') }})
      {% endif %}
    </p>

    <div class="row g-3 mb-3 no-print">
      <div class="col-md-12">
        <div class="card shadow p-3">
          <form method="GET" action="{{ url_for('loan_customers') }}" class="row g-2 align-items-end">
            <div class="col-md-3">
              <label class="form-label"><i class="fas fa-calendar"></i> শুরুর তারিখ</label>
              <input type="date" name="from_date" class="form-control" value="{{ from_date }}" required>
            </div>
            <div class="col-md-3">
              <label class="form-label"><i class="fas fa-calendar"></i> শেষ তারিখ</label>
              <input type="date" name="to_date" class="form-control" value="{{ to_date }}" required>
            </div>
            <div class="col-md-6">
              <button type="submit" class="btn btn-primary me-2"><i class="fas fa-filter"></i> ফিল্টার করুন</button>
              <a href="{{ url_for('loan_customers') }}" class="btn btn-secondary"><i class="fas fa-redo"></i> রিসেট</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="row g-3 mb-4 no-print">
      <div class="col-md-12">
        <div class="stat-card card shadow p-3">
          <div class="row text-center">
            <div class="col-md-3">
              <div class="p-3 bg-primary text-white rounded">
                <i class="fas fa-users fa-2x mb-2"></i>
                <h6 class="mb-1">মোট গ্রাহক</h6>
                <h3 class="mb-0">{{ customers|length }}</h3>
              </div>
            </div>
            <div class="col-md-3">
              <div class="p-3 bg-warning text-dark rounded">
                <i class="fas fa-money-bill-wave fa-2x mb-2"></i>
                <h6 class="mb-1">মোট লোন</h6>
                <h3 class="mb-0">৳{{ "{:,.0f}".format(customers|sum(attribute='total_loan')) }}</h3>
              </div>
            </div>
            <div class="col-md-3">
              <div class="p-3 bg-danger text-white rounded">
                <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                <h6 class="mb-1">বাকি লোন</h6>
                <h3 class="mb-0">৳{{ "{:,.0f}".format(customers|sum(attribute='remaining_loan')) }}</h3>
              </div>
            </div>
            <div class="col-md-3">
              <div class="p-3 bg-success text-white rounded">
                <i class="fas fa-piggy-bank fa-2x mb-2"></i>
                <h6 class="mb-1">মোট সেভিংস</h6>
                <h3 class="mb-0">৳{{ "{:,.0f}".format(customers|sum(attribute='savings_balance')) }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-container shadow">
      <div class="p-3 bg-light border-bottom no-print">
        <h5 class="mb-0"><i class="fas fa-list"></i> Loan Customer List</h5>
      </div>
      <div class="table-responsive">
        <table class="table table-hover table-striped mb-0">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>সদস্য নং</th>
              <th>Name</th>
              <th>Phone</th>
              <th>Total Loan</th>
              <th>Remaining</th>
              <th>Savings</th>
              <th>Staff</th>
              <th class="no-print">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for customer in customers %}
            <tr>
              <td><strong>{{ loop.index }}</strong></td>
              <td><span class="badge bg-secondary member-no">{{ customer.member_no }}</span></td>
              <td><strong>{{ customer.name }}</strong></td>
              <td><i class="fas fa-phone"></i> {{ customer.phone }}</td>
              <td><span class="text-primary loan-amount">৳{{ "{:,.0f}".format(customer.total_loan) }}</span></td>
              <td><span class="badge bg-danger remaining-loan">৳{{ "{:,.0f}".format(customer.remaining_loan) }}</span></td>
              <td><span class="badge bg-success savings-amount">৳{{ "{:,.0f}".format(customer.savings_balance) }}</span></td>
              <td><span class="badge bg-info staff-name">{{ customer.staff.name if customer.staff else 'N/A' }}</span></td>
              <td class="no-print">
                <a href="{{ url_for('customer_details', id=customer.id) }}" class="btn btn-sm btn-info"><i class="fas fa-eye"></i> Details</a>
              </td>
            </tr>
            {% endfor %}
            {% if not customers %}
            <tr>
              <td colspan="9" class="text-center py-4 text-muted">
                <i class="fas fa-inbox fa-3x mb-2"></i>
                <p>No loan customers found</p>
              </td>
            </tr>
            {% endif %}
          </tbody>
          <tfoot>
            <tr style="font-weight: bold; background-color: #f0f0f0;">
              <td colspan="4" style="text-align: right; padding-right: 10px;">সর্বমোট:</td>
              <td style="text-align: left;">৳{{ "{:,.2f}".format(customers|sum(attribute='total_loan')) }}</td>
              <td style="text-align: left;">৳{{ "{:,.2f}".format(customers|sum(attribute='remaining_loan')) }}</td>
              <td style="text-align: left;">৳{{ "{:,.2f}".format(customers|sum(attribute='savings_balance')) }}</td>
              <td colspan="2"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    
    <div class="d-none print-only" style="margin-top: 20px; font-weight: bold;">
      <p>মোট গ্রাহক সংখ্যা: {{ customers|length }}</p>
      <p>মোট লোন: ৳{{ "{:,.2f}".format(customers|sum(attribute='total_loan')) }}</p>
      <p>মোট বাকি লোন: ৳{{ "{:,.2f}".format(customers|sum(attribute='remaining_loan')) }}</p>
      <p>মোট সেভিংস: ৳{{ "{:,.2f}".format(customers|sum(attribute='savings_balance')) }}</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .print-only { display: none; }
    .no-print { display: block; }
    
    @media print {
      body { background: white !important; }
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      .table-container { box-shadow: none !important; border: 2px solid #000; }
      
      body { 
        font-size: 12px; 
        margin: 20px; 
        font-family: Arial, sans-serif;
      }
      
      table { 
        font-size: 11px; 
        border: 2px solid #000; 
        width: 100%;
        margin-top: 10px;
      }
      
      th { 
        padding: 8px !important; 
        background-color: #e0e0e0 !important; 
        border: 1px solid #000; 
        font-weight: bold;
        text-align: center;
        color: #000 !important;
      }
      
      td { 
        padding: 6px !important; 
        border: 1px solid #000; 
        color: #000 !important;
      }
      
      td:first-child {
        text-align: center;
        font-weight: bold;
      }
      
      td:nth-child(4), td:nth-child(5), td:nth-child(6) {
        text-align: right;
      }
      
      /* Remove all badge colors and make text black */
      .badge, .member-no, .remaining-loan, .savings-amount, .staff-name { 
        background-color: transparent !important;
        color: #000 !important; 
        font-weight: bold;
        border: none !important;
        padding: 0 !important;
      }
      
      .text-primary, .text-danger, .text-success, .loan-amount { 
        color: #000 !important; 
        font-weight: bold; 
      }
      
      /* Make all text black */
      span, strong, i { 
        color: #000 !important; 
      }
      
      tbody tr:nth-child(even) {
        background-color: #f5f5f5;
      }
      
      tfoot td {
        padding: 8px !important;
        font-weight: bold;
        background-color: #e0e0e0 !important;
      }
    }
  </style>
</body>
</html>
