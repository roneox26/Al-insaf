<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Loan Customers</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container mt-5">
  <h2 class="mb-4 no-print">üí∞ Loan Customers</h2>
  <h2 class="d-none print-only" style="text-align: center; margin-bottom: 5px;">‡¶Ü‡¶≤-‡¶á‡¶®‡¶∏‡¶æ‡¶´ ‡¶è‡¶®‡¶ú‡¶ø‡¶ì</h2>
  <h3 class="d-none print-only" style="text-align: center; margin: 0;">‡¶≤‡ßã‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
  <p class="d-none print-only" style="text-align: center; margin: 5px 0 15px 0;">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: {{ now.strftime('%d-%m-%Y') }}</p>
  <button onclick="window.print()" class="btn btn-primary mb-3 no-print">üñ®Ô∏è Print</button>

  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶Ç</th>
        <th>Name</th>
        <th>Phone</th>
        <th>Total Loan</th>
        <th>Remaining</th>
        <th>Savings</th>
        <th>Staff</th>
        <th class="no-print">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for customer in customers %}
      <tr>
        <td><strong>{{ customer.member_no }}</strong></td>
        <td>{{ customer.name }}</td>
        <td>{{ customer.phone }}</td>
        <td>‡ß≥{{ "{:,.2f}".format(customer.total_loan) }}</td>
        <td><span class="text-danger">‡ß≥{{ "{:,.2f}".format(customer.remaining_loan) }}</span></td>
        <td><span class="text-success">‡ß≥{{ "{:,.2f}".format(customer.savings_balance) }}</span></td>
        <td>{{ customer.staff.name if customer.staff else 'N/A' }}</td>
        <td class="no-print">
          <a href="{{ url_for('customer_details', id=customer.id) }}" class="btn btn-sm btn-info">üìã Details</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot class="print-only">
      <tr style="font-weight: bold; background-color: #f0f0f0;">
        <td colspan="3" style="text-align: center;">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü</td>
        <td style="text-align: right;">‡ß≥{{ "{:,.2f}".format(customers|sum(attribute='total_loan')) }}</td>
        <td style="text-align: right;">‡ß≥{{ "{:,.2f}".format(customers|sum(attribute='remaining_loan')) }}</td>
        <td style="text-align: right;">‡ß≥{{ "{:,.2f}".format(customers|sum(attribute='savings_balance')) }}</td>
        <td></td>
      </tr>
    </tfoot>
  </table>
  
  <div class="d-none print-only" style="margin-top: 20px; font-weight: bold;">
    <p>‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ: {{ customers|length }}</p>
    <p>‡¶Æ‡ßã‡¶ü ‡¶≤‡ßã‡¶®: ‡ß≥{{ "{:,.2f}".format(customers|sum(attribute='total_loan')) }}</p>
    <p>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶≤‡ßã‡¶®: ‡ß≥{{ "{:,.2f}".format(customers|sum(attribute='remaining_loan')) }}</p>
  </div>

  {% if not customers %}
  <div class="alert alert-info">No loan customers found.</div>
  {% endif %}

  <a href="{{ url_for('dashboard') }}" class="btn btn-secondary mt-3 no-print">‚¨ÖÔ∏è Back</a>

  <style>
    .print-only { display: none; }
    
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      
      body { 
        font-size: 12px; 
        margin: 20px; 
        font-family: Arial, sans-serif;
      }
      
      table { 
        font-size: 11px; 
        border: 2px solid #000; 
        width: 100%;
        margin-top: 10px;
      }
      
      th { 
        padding: 8px !important; 
        background-color: #e0e0e0 !important; 
        border: 1px solid #000; 
        font-weight: bold;
        text-align: center;
      }
      
      td { 
        padding: 6px !important; 
        border: 1px solid #000; 
      }
      
      td:first-child {
        text-align: center;
        font-weight: bold;
      }
      
      td:nth-child(4), td:nth-child(5), td:nth-child(6) {
        text-align: right;
      }
      
      .text-danger { 
        color: #000 !important; 
        font-weight: bold; 
      }
      
      .text-success { 
        color: #000 !important; 
        font-weight: bold; 
      }
      
      tbody tr:nth-child(even) {
        background-color: #f5f5f5;
      }
      
      tfoot td {
        padding: 8px !important;
        font-weight: bold;
        background-color: #e0e0e0 !important;
      }
    }
  </style>
</body>
</html>
