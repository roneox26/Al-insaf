<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdrawal Report - Al-Insaf NGO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); min-height: 100vh; }
        .page-title { color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .main-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .stat-card { border-radius: 12px; transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .table-container { background: white; border-radius: 10px; overflow: hidden; }
        
        @media print {
            body { background: white !important; margin: 10mm; }
            .no-print { display: none !important; }
            .table-container { box-shadow: none !important; border: 1px solid #000; }
            .page-title { color: black !important; text-shadow: none !important; }
            
            #print-header { display: block !important; }
            #print-header h2 { text-align: center; margin: 5px 0; font-size: 18px; }
            #print-header h4 { text-align: center; margin: 5px 0; font-size: 14px; }
            #print-header p { text-align: center; margin: 5px 0; font-size: 11px; }
            
            .print-stats { 
                display: table !important;
                width: 100% !important;
                table-layout: fixed !important;
                border-collapse: collapse !important;
                margin: 15px 0 !important;
            }
            .print-stats .stat-box {
                display: table-cell !important;
                width: 33.33% !important;
                border: 2px solid #000 !important;
                padding: 10px 5px !important;
                text-align: center !important;
                background: #f8f9fa !important;
                vertical-align: middle !important;
            }
            .print-stats .stat-box h6 { 
                font-size: 11px !important;
                margin: 0 0 5px 0 !important;
                font-weight: bold !important;
                color: #000 !important;
            }
            .print-stats .stat-box h5 { 
                font-size: 16px !important;
                margin: 0 !important;
                font-weight: bold !important;
                color: #000 !important;
            }
            
            table { font-size: 10px; width: 100%; margin-top: 10px; }
            th, td { padding: 4px !important; border: 1px solid #000 !important; }
            th { background: #e0e0e0 !important; font-weight: bold; }
            .badge { border: 1px solid #000; padding: 2px 4px; font-size: 9px; }
        }
    </style>
</head>
<body>
    <div class="container mt-4 pb-5">
        <div class="d-flex justify-content-between align-items-center mb-4 no-print">
            <h2 class="page-title"><i class="fas fa-money-bill-transfer"></i> Withdrawal Report</h2>
            <div>
                <a href="{{ url_for('customer_search') }}" class="btn btn-info me-2"><i class="fas fa-search"></i> Customer Search</a>
                <button onclick="window.print()" class="btn btn-light me-2"><i class="fas fa-print"></i> Print</button>
                <a href="{{ url_for('manage_withdrawals') }}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back</a>
            </div>
        </div>
        
        <div id="print-header" style="display:none;">
            <h2>আল-ইনসাফ ক্ষুদ্র ব্যবসায়ী সমবায় সমিতি লিঃ</h2>
            <h4>Withdrawal Report</h4>
            <p>তারিখ: {{ now.strftime('%d-%m-%Y') }}</p>
            
            <div class="print-stats">
                <div class="stat-box">
                    <h6>মোট Withdrawal</h6>
                    <h5>৳{{ "{:,.0f}".format(total) }}</h5>
                </div>
                <div class="stat-box">
                    <h6>সঞ্চয় ফেরত</h6>
                    <h5>৳{{ "{:,.0f}".format(savings_total) }}</h5>
                </div>
                <div class="stat-box">
                    <h6>বিনিয়োগ ফেরত</h6>
                    <h5>৳{{ "{:,.0f}".format(investment_total) }}</h5>
                </div>
            </div>
        </div>

        <div class="main-card p-4 mb-4 no-print">
            <h5 class="mb-3"><i class="fas fa-filter"></i> Filter by Date</h5>
            <form method="GET" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label"><i class="fas fa-calendar-alt"></i> From Date</label>
                    <input type="date" class="form-control" name="from_date" value="{{ from_date }}">
                </div>
                <div class="col-md-4">
                    <label class="form-label"><i class="fas fa-calendar-alt"></i> To Date</label>
                    <input type="date" class="form-control" name="to_date" value="{{ to_date }}">
                </div>
                <div class="col-md-4">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-search"></i> Filter</button>
                    <a href="{{ url_for('withdrawal_report') }}" class="btn btn-outline-secondary w-100 mt-2"><i class="fas fa-redo"></i> Reset</a>
                </div>
            </form>
        </div>

        <div class="row g-3 mb-4 no-print">
            <div class="col-md-4">
                <div class="stat-card card shadow p-4 bg-danger text-white text-center">
                    <div class="mb-2"><i class="fas fa-money-bill-transfer fa-2x"></i></div>
                    <h6 class="mb-1">মোট Withdrawal</h6>
                    <h3 class="mb-0">৳{{ "{:,.0f}".format(total) }}</h3>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card card shadow p-4 bg-info text-white text-center">
                    <div class="mb-2"><i class="fas fa-piggy-bank fa-2x"></i></div>
                    <h6 class="mb-1">সঞ্চয় ফেরত</h6>
                    <h3 class="mb-0">৳{{ "{:,.0f}".format(savings_total) }}</h3>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card card shadow p-4 bg-secondary text-white text-center">
                    <div class="mb-2"><i class="fas fa-hand-holding-dollar fa-2x"></i></div>
                    <h6 class="mb-1">বিনিয়োগ ফেরত</h6>
                    <h3 class="mb-0">৳{{ "{:,.0f}".format(investment_total) }}</h3>
                </div>
            </div>
        </div>

        <div class="table-container shadow">
            <div class="p-3 bg-light border-bottom no-print">
                <h5 class="mb-0"><i class="fas fa-list"></i> Withdrawal Records ({{ withdrawals|length }})</h5>
            </div>
            <div class="table-responsive">
                <table class="table table-hover table-striped mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th style="width: 5%;">#</th>
                            <th style="width: 10%;">Member No.</th>
                            <th style="width: 12%;">Date</th>
                            <th style="width: 13%;">Type</th>
                            <th style="width: 25%;">Name</th>
                            <th style="width: 15%;">Amount</th>
                            <th style="width: 20%;">Note</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for withdrawal in withdrawals %}
                        <tr>
                            <td><strong>{{ loop.index }}</strong></td>
                            <td>
                                {% if withdrawal.customer %}
                                    <span class="badge bg-secondary">{{ withdrawal.customer.member_no }}</span>
                                {% else %}
                                    <span class="badge bg-dark">INV</span>
                                {% endif %}
                            </td>
                            <td><small><i class="fas fa-calendar"></i> {{ withdrawal.date.strftime('%d-%m-%Y') }}</small></td>
                            <td>
                                {% if withdrawal.withdrawal_type == 'savings' %}
                                    <span class="badge bg-info">সঞ্চয় ফেরত</span>
                                {% else %}
                                    <span class="badge bg-secondary">বিনিয়োগ ফেরত</span>
                                {% endif %}
                            </td>
                            <td>
                                <strong>
                                {% if withdrawal.customer %}
                                    {{ withdrawal.customer.name }}
                                {% else %}
                                    {{ withdrawal.investor_name }}
                                {% endif %}
                                </strong>
                            </td>
                            <td><span class="text-danger fw-bold">৳{{ "{:,.0f}".format(withdrawal.amount) }}</span></td>
                            <td><small>{{ withdrawal.note or '-' }}</small></td>
                        </tr>
                        {% endfor %}
                        {% if withdrawals %}
                        <tr style="background: #f0f0f0; font-weight: bold;">
                            <td colspan="5" class="text-end">মোট Withdrawal:</td>
                            <td><strong>৳{{ "{:,.0f}".format(total) }}</strong></td>
                            <td></td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="text-center py-4 text-muted">
                                <i class="fas fa-inbox fa-3x mb-2"></i>
                                <p>কোনো Withdrawal রেকর্ড পাওয়া যায়নি</p>
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.onbeforeprint = function() {
            document.getElementById('print-header').style.display = 'block';
        };
        window.onafterprint = function() {
            document.getElementById('print-header').style.display = 'none';
        };
    </script>
</body>
</html>
