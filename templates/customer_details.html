<!doctype html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta charset="utf-8">
  <title>Customer Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
</head>

<body class="container mt-5">
  <h2 class="mb-4">👤 Customer Details</h2>

  <div class="card shadow mb-4">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">👤 {{ customer.name }}</h4>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <table class="table table-sm">
            <tr><td><strong>🎯 সদস্যা নং:</strong></td><td>{{ customer.member_no or 'N/A' }}</td></tr>
            <tr><td><strong>📞 মোবাইল:</strong></td><td>{{ customer.phone }}</td></tr>
            <tr><td><strong>👨 পিতা/স্বামী:</strong></td><td>{{ customer.father_husband or 'N/A' }}</td></tr>
            <tr><td><strong>🏘️ গ্রাম:</strong></td><td>{{ customer.village or 'N/A' }}</td></tr>
            <tr><td><strong>🏤 পোস্ট:</strong></td><td>{{ customer.post or 'N/A' }}</td></tr>
            <tr><td><strong>🏛️ থানা:</strong></td><td>{{ customer.thana or 'N/A' }}</td></tr>
          </table>
        </div>
        <div class="col-md-6">
          <table class="table table-sm">
            <tr><td><strong>🏛️ জেলা:</strong></td><td>{{ customer.district or 'N/A' }}</td></tr>
            <tr><td><strong>🤝 জামিনদার:</strong></td><td>{{ customer.granter or 'N/A' }}</td></tr>
            <tr><td><strong>💼 পেশা:</strong></td><td>{{ customer.profession or 'N/A' }}</td></tr>
            <tr><td><strong>🎫 NID:</strong></td><td>{{ customer.nid_no or 'N/A' }}</td></tr>
            <tr><td><strong>💵 ভর্তি ফি:</strong></td><td>৳{{ "{:,.2f}".format(customer.admission_fee or 0) }}</td></tr>
            <tr><td><strong>👨‍💼 Staff:</strong></td><td>{{ customer.staff.name if customer.staff else 'N/A' }}</td></tr>
            <tr><td><strong>📅 যোগ তারিখ:</strong></td><td>{{ customer.created_date.strftime('%d-%m-%Y') }}</td></tr>
          </table>
        </div>
      </div>
      {% if customer.address %}
      <div class="alert alert-info mt-2 mb-0">
        <strong>📍 ঠিকানা:</strong> {{ customer.address }}
      </div>
      {% endif %}
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card shadow p-3 bg-primary text-white">
        <h6>💵 Total Loan</h6>
        <h3>৳{{ "{:,.2f}".format(customer.total_loan) }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow p-3 bg-danger text-white">
        <h6>⚠️ Remaining Loan</h6>
        <h3>৳{{ "{:,.2f}".format(customer.remaining_loan) }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow p-3 bg-success text-white">
        <h6>✅ Total Collected</h6>
        <h3>৳{{ "{:,.2f}".format(total_collected) }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow p-3 bg-info text-white">
        <h6>💰 Savings Balance</h6>
        <h3>৳{{ "{:,.2f}".format(customer.savings_balance) }}</h3>
      </div>
    </div>
  </div>

  <h4 class="mt-4">💰 Collection History</h4>
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>ক্রমিক</th>
        <th>💵 Loan</th>
        <th>💰 Saving</th>
        <th>📅 Date</th>
        <th>👤 Collected By</th>
      </tr>
    </thead>
    <tbody>
      {% for item in all_collections %}
      <tr>
        <td>{{ loop.index }}</td>
        <td class="text-end">{{ '৳{:,.2f}'.format(item.loan) if item.loan > 0 else '-' }}</td>
        <td class="text-end">{{ '৳{:,.2f}'.format(item.saving) if item.saving > 0 else '-' }}</td>
        <td>{{ item.date.strftime('%d-%m-%Y %H:%M') }}</td>
        <td>{{ item.staff }}</td>
      </tr>
      {% endfor %}
      {% if not all_collections %}
      <tr>
        <td colspan="5" class="text-center">কোন collection নেই</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <h4 class="mt-4">💵 Savings Withdrawal History</h4>
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>ক্রমিক</th>
        <th>💵 Amount</th>
        <th>📅 Date</th>
        <th>📝 Note</th>
      </tr>
    </thead>
    <tbody>
      {% for w in withdrawals %}
      <tr class="table-warning">
        <td>{{ loop.index }}</td>
        <td class="text-end">৳{{ "{:,.2f}".format(w.amount) }}</td>
        <td>{{ w.date.strftime('%d-%m-%Y %H:%M') }}</td>
        <td>{{ w.note or '-' }}</td>
      </tr>
      {% endfor %}
      {% if not withdrawals %}
      <tr>
        <td colspan="4" class="text-center">কোন withdrawal নেই</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  {% if total_withdrawn > 0 %}
  <div class="alert alert-warning mt-3">
    <strong>💵 মোট উত্তোলন:</strong> ৳{{ "{:,.2f}".format(total_withdrawn) }}
  </div>
  {% endif %}

  <a href="{{ url_for('customer_details_print', id=customer.id) }}" class="btn btn-primary mt-3" target="_blank">🖨️ Print Details</a>
  <a href="{{ url_for('customer_loan_sheet', id=customer.id) }}" class="btn btn-info mt-3" target="_blank">📄 Loan Sheet</a>
  <a href="{{ url_for('edit_customer', id=customer.id) }}" class="btn btn-warning mt-3">✏️ Edit Customer</a>
  <button onclick="goBack()" class="btn btn-secondary mt-3">⬅️ Back</button>
  
  <script>
  function goBack() {
    if (document.referrer && document.referrer !== window.location.href) {
      window.location.href = document.referrer;
    } else {
      window.location.href = "{{ url_for('manage_customers') }}";
    }
  }
  </script>
</body>
</html>
