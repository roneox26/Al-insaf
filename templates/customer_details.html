<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Customer Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container mt-5">
  <h2 class="mb-4">ЁЯСд Customer Details</h2>

  <div class="card shadow mb-4">
    <div class="card-body">
      <h4>ЁЯСд {{ customer.name }}</h4>
      <div class="row">
        <div class="col-md-6">
          <p><strong>рж╕ржжрж╕рзНржпрж╛ ржиржВ:</strong> {{ customer.member_no or 'N/A' }}</p>
          <p><strong>ЁЯУЮ ржорзЛржмрж╛ржЗрж▓:</strong> {{ customer.phone }}</p>
          <p><strong>ЁЯСи ржкрж┐рждрж╛/рж╕рзНржмрж╛ржорзА:</strong> {{ customer.father_husband or 'N/A' }}</p>
          <p><strong>ЁЯПШя╕П ржЧрзНрж░рж╛ржо:</strong> {{ customer.village or 'N/A' }}</p>
          <p><strong>ЁЯПд ржкрзЛрж╕рзНржЯ:</strong> {{ customer.post or 'N/A' }}</p>
          <p><strong>ЁЯПЫя╕П ржерж╛ржирж╛:</strong> {{ customer.thana or 'N/A' }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>ЁЯПЫя╕П ржЬрзЗрж▓рж╛:</strong> {{ customer.district or 'N/A' }}</p>
          <p><strong>ЁЯдЭ ржЬрж╛ржорж┐ржиржжрж╛рж░:</strong> {{ customer.granter or 'N/A' }}</p>
          <p><strong>ЁЯТ╝ ржкрзЗрж╢рж╛:</strong> {{ customer.profession or 'N/A' }}</p>
          <p><strong>ЁЯОл NID:</strong> {{ customer.nid_no or 'N/A' }}</p>
          <p><strong>ЁЯТ╡ ржнрж░рзНрждрж┐ ржлрж┐:</strong> рз│{{ "{:,.2f}".format(customer.admission_fee or 0) }}</p>
          <p><strong>ЁЯСитАНЁЯТ╝ Staff:</strong> {{ customer.staff.name if customer.staff else 'N/A' }}</p>
          <p><strong>ЁЯУЕ ржпрзЛржЧ рждрж╛рж░рж┐ржЦ:</strong> {{ customer.created_date.strftime('%Y-%m-%d') }}</p>
        </div>
      </div>
      {% if customer.address %}
      <p class="mt-2"><strong>ЁЯУН ржарж┐ржХрж╛ржирж╛:</strong> {{ customer.address }}</p>
      {% endif %}
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card shadow p-3 bg-primary text-white">
        <h5>Total Loan</h5>
        <h3>рз│{{ "{:,.2f}".format(customer.total_loan) }}</h3>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow p-3 bg-danger text-white">
        <h5>Remaining Loan</h5>
        <h3>рз│{{ "{:,.2f}".format(customer.remaining_loan) }}</h3>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow p-3 bg-success text-white">
        <h5>Total Collected</h5>
        <h3>рз│{{ "{:,.2f}".format(total_collected) }}</h3>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow p-3">
        <h5>Savings Balance</h5>
        <h3 class="text-success">рз│{{ "{:,.2f}".format(customer.savings_balance) }}</h3>
      </div>
    </div>
  </div>

  <h4 class="mt-4">ЁЯТ░ Collection History</h4>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Loan</th>
        <th>Saving</th>
        <th>Date</th>
        <th>Collected By</th>
      </tr>
    </thead>
    <tbody>
      {% for item in all_collections %}
      <tr>
        <td>{{ 'рз│{:,.2f}'.format(item.loan) if item.loan > 0 else '-' }}</td>
        <td>{{ 'рз│{:,.2f}'.format(item.saving) if item.saving > 0 else '-' }}</td>
        <td>{{ item.date.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ item.staff }}</td>
      </tr>
      {% endfor %}
      {% if not all_collections %}
      <tr>
        <td colspan="4" class="text-center">No collections yet</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <h4 class="mt-4">ЁЯТ╡ Savings Withdrawal History</h4>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Amount</th>
        <th>Date</th>
        <th>Note</th>
      </tr>
    </thead>
    <tbody>
      {% for w in withdrawals %}
      <tr class="table-danger">
        <td>рз│{{ "{:,.2f}".format(w.amount) }}</td>
        <td>{{ w.date.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ w.note or '-' }}</td>
      </tr>
      {% endfor %}
      {% if not withdrawals %}
      <tr>
        <td colspan="3" class="text-center">No withdrawals yet</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <div class="alert alert-info mt-3">
    <strong>ржорзЛржЯ ржЙрждрзНрждрзЛрж▓ржи:</strong> рз│{{ "{:,.2f}".format(total_withdrawn) }}
  </div>

  <a href="{{ url_for('customer_details_print', id=customer.id) }}" class="btn btn-primary mt-3" target="_blank">ЁЯЦия╕П Print Details</a>
  <a href="{{ url_for('loan_customers') }}" class="btn btn-secondary mt-3">тмЕя╕П Back to Loan Customers</a>
</body>
</html>
