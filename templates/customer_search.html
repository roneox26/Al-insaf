<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Search - Al-Insaf NGO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-responsive.css') }}">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .search-container { max-width: 1400px; margin: 0 auto; padding: 30px 15px; }
        .search-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .search-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 20px 20px 0 0; }
        .search-input { font-size: 1.2rem; padding: 15px 20px; border-radius: 50px; border: 3px solid #667eea; }
        .search-input:focus { border-color: #764ba2; box-shadow: 0 0 0 0.25rem rgba(118, 75, 162, 0.25); }
        .customer-card { transition: all 0.3s; border: 2px solid #e0e0e0; border-radius: 15px; }
        .customer-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); border-color: #667eea; }
        .stat-badge { font-size: 1.1rem; padding: 8px 15px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="search-container">
        <div class="search-card">
            <div class="search-header text-center">
                <h1 class="mb-3"><i class="fas fa-search"></i> Customer Search</h1>
                <p class="mb-0">‡¶®‡¶æ‡¶Æ, ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶Ç, ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</p>
            </div>
            
            <div class="p-4">
                <div class="mb-4">
                    <input type="text" id="customerSearch" class="form-control search-input" placeholder="üîç ‡¶®‡¶æ‡¶Æ, ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶Ç, ‡¶´‡ßã‡¶®..." autocomplete="off" autofocus>
                </div>
                
                <div id="searchResults" class="row g-3"></div>
                
                <div id="emptyState" class="text-center py-5 text-muted">
                    <i class="fas fa-search fa-4x mb-3"></i>
                    <h4>Customer ‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶§‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                    <p>‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá 2 ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</p>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="{{ url_for('dashboard') }}" class="btn btn-light btn-lg">
                <i class="fas fa-arrow-left"></i> Dashboard ‡¶è ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const searchInput = document.getElementById('customerSearch');
        const searchResults = document.getElementById('searchResults');
        const emptyState = document.getElementById('emptyState');
        let searchTimeout;

        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            if (query.length < 2) {
                searchResults.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            searchResults.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary" role="status"></div></div>';

            searchTimeout = setTimeout(() => {
                fetch(`/api/search_customers?q=${encodeURIComponent(query)}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.customers.length === 0) {
                            searchResults.innerHTML = `
                                <div class="col-12 text-center py-5 text-muted">
                                    <i class="fas fa-inbox fa-3x mb-3"></i>
                                    <h4>‡¶ï‡ßã‡¶®‡ßã ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h4>
                                    <p>"${query}" ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶®‡ßá‡¶á</p>
                                </div>
                            `;
                            return;
                        }

                        let html = '';
                        data.customers.forEach(c => {
                            // Determine status badge color
                            let statusBadge = '';
                            if (c.loan_status === '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§') {
                                statusBadge = '<span class="badge bg-success"><i class="fas fa-check-circle"></i> ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</span>';
                            } else if (c.loan_status === '‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®') {
                                statusBadge = '<span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®</span>';
                            } else {
                                statusBadge = '<span class="badge bg-info"><i class="fas fa-user-plus"></i> ‡¶®‡¶§‡ßÅ‡¶®</span>';
                            }
                            
                            html += `
                                <div class="col-md-6 col-lg-4">
                                    <div class="card customer-card h-100">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div>
                                                    <h5 class="card-title mb-1">
                                                        <i class="fas fa-user text-primary"></i> ${c.name}
                                                    </h5>
                                                    <div>
                                                        <span class="badge bg-secondary me-1">${c.member_no}</span>
                                                        ${statusBadge}
                                                    </div>
                                                </div>
                                                <div class="btn-group-vertical">
                                                    <a href="{{ url_for('customer_details', id='') }}${c.id}" class="btn btn-sm btn-primary mb-1" title="Details">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="{{ url_for('customer_loan_sheet', id='') }}${c.id}" class="btn btn-sm btn-success" title="Loan Sheet">
                                                        <i class="fas fa-file-invoice"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <div class="row g-2 text-center">
                                                    <div class="col-6">
                                                        <div class="p-2 bg-primary bg-opacity-10 rounded">
                                                            <small class="text-muted d-block" style="font-size: 0.7rem;"><i class="fas fa-coins"></i> ‡¶Æ‡ßã‡¶ü ‡¶≤‡ßã‡¶®</small>
                                                            <strong class="text-primary">‡ß≥${c.total_loan.toLocaleString()}</strong>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="p-2 bg-danger bg-opacity-10 rounded">
                                                            <small class="text-muted d-block" style="font-size: 0.7rem;"><i class="fas fa-exclamation-circle"></i> ‡¶¨‡¶æ‡¶ï‡¶ø</small>
                                                            <strong class="text-danger">‡ß≥${c.remaining_loan.toLocaleString()}</strong>
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <div class="p-2 bg-success bg-opacity-10 rounded">
                                                            <small class="text-muted d-block" style="font-size: 0.7rem;"><i class="fas fa-piggy-bank"></i> ‡¶∏‡ßá‡¶≠‡¶ø‡¶Ç‡¶∏</small>
                                                            <strong class="text-success">‡ß≥${c.savings_balance.toLocaleString()}</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-2" style="font-size: 0.85rem;">
                                                <small class="text-muted d-block mb-1">
                                                    <i class="fas fa-phone text-success"></i> ${c.phone}
                                                </small>
                                                <small class="text-muted d-block mb-1">
                                                    <i class="fas fa-map-marker-alt text-danger"></i> ${c.village}
                                                </small>
                                                <small class="text-muted d-block mb-1">
                                                    <i class="fas fa-male text-primary"></i> <strong>‡¶™‡¶ø‡¶§‡¶æ/‡¶∏‡ßç‡¶¨‡¶æ‡¶Æ‡ßÄ:</strong> ${c.father_husband}
                                                </small>
                                                <small class="text-muted d-block mb-1">
                                                    <i class="fas fa-briefcase text-warning"></i> <strong>‡¶™‡ßá‡¶∂‡¶æ:</strong> ${c.profession}
                                                </small>
                                                <small class="text-muted d-block mb-1">
                                                    <i class="fas fa-id-card text-secondary"></i> <strong>NID:</strong> ${c.nid_no}
                                                </small>
                                                <small class="text-muted d-block mb-1">
                                                    <i class="fas fa-calendar-plus text-info"></i> <strong>‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®:</strong> ${c.created_date}
                                                </small>
                                                <small class="text-muted d-block mb-1">
                                                    <i class="fas fa-user-tie text-info"></i> <strong>‡¶∏‡ßç‡¶ü‡¶æ‡¶´:</strong> ${c.staff_name}
                                                </small>
                                            </div>
                                            
                                            ${c.total_loan > 0 ? `
                                            <div class="mb-2">
                                                <div class="d-flex justify-content-between align-items-center mb-1">
                                                    <small class="text-muted">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</small>
                                                    <small class="text-primary fw-bold">${c.payment_percentage}%</small>
                                                </div>
                                                <div class="progress" style="height: 8px;">
                                                    <div class="progress-bar ${c.payment_percentage >= 75 ? 'bg-success' : c.payment_percentage >= 50 ? 'bg-info' : c.payment_percentage >= 25 ? 'bg-warning' : 'bg-danger'}" 
                                                         role="progressbar" style="width: ${c.payment_percentage}%"></div>
                                                </div>
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        searchResults.innerHTML = html;
                    })
                    .catch(err => {
                        searchResults.innerHTML = `
                            <div class="col-12 text-center py-5 text-danger">
                                <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                                <h4>Error loading results</h4>
                            </div>
                        `;
                    });
            }, 300);
        });
    </script>
</body>
</html>
