<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Add Customer - Al-Insaf NGO</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); min-height: 100vh; }
    .page-title { color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
    .form-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    .section-title { color: #667eea; font-weight: 600; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin-bottom: 20px; }
  </style>
</head>

<body>
  <div class="container mt-4 pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="page-title"><i class="fas fa-user-plus"></i> নতুন সদস্য যোগ করুন</h2>
      <a href="{{ url_for('manage_customers') }}" class="btn btn-light"><i class="fas fa-arrow-left"></i> Back</a>
    </div>

    <div class="form-card p-4">
      <form method="POST" enctype="multipart/form-data">
        <h5 class="section-title"><i class="fas fa-user"></i> ব্যক্তিগত তথ্য</h5>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-user"></i> সদস্যা নাম *</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-phone"></i> মোবাইল নং *</label>
            <input type="text" name="phone" class="form-control" required>
          </div>
        </div>
    
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-id-card"></i> সদস্যা নং</label>
            <input type="text" name="member_no" class="form-control">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-user-friends"></i> পিতা/স্বামী</label>
            <input type="text" name="father_husband" class="form-control">
          </div>
        </div>
    
        <h5 class="section-title mt-4"><i class="fas fa-map-marker-alt"></i> ঠিকানা তথ্য</h5>
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label"><i class="fas fa-home"></i> গ্রাম</label>
            <input type="text" name="village" class="form-control">
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label"><i class="fas fa-mail-bulk"></i> পোস্ট</label>
            <input type="text" name="post" class="form-control">
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label"><i class="fas fa-building"></i> থানা</label>
            <input type="text" name="thana" class="form-control">
          </div>
        </div>
    
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-city"></i> জেলা</label>
            <input type="text" name="district" class="form-control">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-phone-square"></i> অভি: ফোন নং</label>
            <input type="text" name="granter" class="form-control" placeholder="অভিভাবকের ফোন নম্বর">
          </div>
        </div>
        
        <div class="mb-3">
          <label class="form-label"><i class="fas fa-address-card"></i> পূর্ণ ঠিকানা</label>
          <textarea name="address" class="form-control" rows="2"></textarea>
        </div>
    
        <h5 class="section-title mt-4"><i class="fas fa-info-circle"></i> অন্যান্য তথ্য</h5>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-briefcase"></i> পেশা</label>
            <input type="text" name="profession" class="form-control">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-id-card-alt"></i> NID নং</label>
            <input type="text" id="nid_no" name="nid_no" class="form-control" placeholder="NID দিলে তথ্য auto-fill হবে">
            <small class="text-muted">NID দিয়ে Enter চাপুন</small>
          </div>
        </div>
    
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-money-bill"></i> ভর্তি ফি</label>
            <input type="number" step="0.01" name="admission_fee" class="form-control" value="0">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-camera"></i> ছবি</label>
            <input type="file" name="photo" class="form-control" accept="image/*">
            <small class="text-muted">JPG, PNG (Max 2MB)</small>
          </div>
        </div>
        
        <div class="d-grid gap-2 mt-4">
          <button type="submit" class="btn btn-success btn-lg"><i class="fas fa-check-circle"></i> সদস্য যোগ করুন</button>
          <a href="{{ url_for('manage_customers') }}" class="btn btn-outline-secondary"><i class="fas fa-times"></i> বাতিল</a>
        </div>
      </form>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // NID Auto-fill functionality
    const nidInput = document.getElementById('nid_no');
    const nameInput = document.querySelector('input[name="name"]');
    const phoneInput = document.querySelector('input[name="phone"]');
    const fatherHusbandInput = document.querySelector('input[name="father_husband"]');
    const villageInput = document.querySelector('input[name="village"]');
    const postInput = document.querySelector('input[name="post"]');
    const thanaInput = document.querySelector('input[name="thana"]');
    const districtInput = document.querySelector('input[name="district"]');
    const granterInput = document.querySelector('input[name="granter"]');
    const professionInput = document.querySelector('input[name="profession"]');
    const addressInput = document.querySelector('textarea[name="address"]');

    nidInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const nid = this.value.trim();
        if (nid.length > 0) {
          fetch(`/api/get_customer_by_nid?nid=${encodeURIComponent(nid)}`)
            .then(res => res.json())
            .then(data => {
              if (data.found) {
                nameInput.value = data.name;
                phoneInput.value = data.phone;
                fatherHusbandInput.value = data.father_husband;
                villageInput.value = data.village;
                postInput.value = data.post;
                thanaInput.value = data.thana;
                districtInput.value = data.district;
                granterInput.value = data.granter;
                professionInput.value = data.profession;
                addressInput.value = data.address;
                
                // Show success message
                const alert = document.createElement('div');
                alert.className = 'alert alert-success alert-dismissible fade show';
                alert.innerHTML = '<i class="fas fa-check-circle"></i> তথ্য auto-fill হয়েছে! <button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
                document.querySelector('.form-card').insertBefore(alert, document.querySelector('form'));
                setTimeout(() => alert.remove(), 3000);
              } else {
                // Show not found message
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning alert-dismissible fade show';
                alert.innerHTML = '<i class="fas fa-exclamation-triangle"></i> এই NID এর কোনো তথ্য পাওয়া যায়নি <button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
                document.querySelector('.form-card').insertBefore(alert, document.querySelector('form'));
                setTimeout(() => alert.remove(), 3000);
              }
            })
            .catch(err => {
              console.error('Error:', err);
              const alert = document.createElement('div');
              alert.className = 'alert alert-danger alert-dismissible fade show';
              alert.innerHTML = '<i class="fas fa-times-circle"></i> Error loading data <button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
              document.querySelector('.form-card').insertBefore(alert, document.querySelector('form'));
              setTimeout(() => alert.remove(), 3000);
            });
        }
      }
    });
  </script>
</body>
</html>
